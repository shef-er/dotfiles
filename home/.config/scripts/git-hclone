#!/usr/bin/env bash

GIT_CLONE_ROOT=${GIT_CLONE_ROOT:-Clones}

gitcmd="$(command -v git 2>/dev/null)"

if [ -z "$gitcmd" ]; then
    exit 1
fi

if [ -z "$1" ]; then
    exit 1
fi

uri="$1"

# Cut out schema prefix
fragments="${uri#*://}"

# Cut out user prefix
fragments="${fragments#*@}"

# Cut out '.git' suffix
fragments="${fragments%.git}"

# Check if URI has schema prefix like 'http://' or 'ssh://'
if [[ "$uri" =~ ^[A-Za-z]+:// ]]; then
    uri_host_dirty="${fragments%%/*}"
    uri_host="${uri_host_dirty%%\:*}"

    uri_path="${fragments#*/}"
else
    # For scp-like
    uri_host_dirty="$fragments"
    uri_host="${uri_host_dirty%%\:*}"

    uri_path="${fragments#*\:}"
fi

$gitcmd clone -- "$uri" "$HOME/$GIT_CLONE_ROOT/$uri_host/$uri_path"
